# Carry My Luggage

参考動画：https://youtu.be/dzyJ1dHTulc <br>
※ 参考動画は完璧ではありません．年によってルールも異なるので，あくまで参考程度にしてください．

※ 詳細なルールや配点につきましては，アリーナ環境が決まり次第，追加していきます．気になる点や議論したい点などがありましたら，[Issues](https://github.com/RoboCupAtHomeJP/Rule2022/issues)へお願いします．

<br>

## メインゴール
このタスクでは，外に駐車された車までロボットがオペレータの荷物運搬を支援することを想定しています．ロボットは荷物(バッグ)を掴んだ後，既知の環境から未知の環境内までオペレータ追従し，荷物運搬の支援を行います．その後，自律的にスタート地点(既知の環境)まで戻ることことを行います．

※ Educationリーグと同じ競技を採用していますが，差別化のため異なる採点方式を用いています．

<br>

## フォーカス
このタスクは，指差し認識，マニピュレーション，既知環境と未知環境でのマッピングやナビゲーション，人追従走行，音声対話，タスクプランニングなどに焦点を当てています．

<br>

## セットアップ
- ロケーション：家庭環境を模したアリーナ環境が用いられます．競技はアリーナの内外で行われます．アリーナ内は事前にマッピングすることができます(既知の環境)が，アリーナ外は事前にマッピングすることはできません(未知の環境)．
- スタートロケーション： ロボットは，リビングルームの事前に指定された場所からスタートします．
- 荷物(バッグ)： オペレーターの近く(2m以内の距離でロボットから見える位置)に，少なくとも2つのバッグが設置されます．
- オペレーター： オペレーターは，ロボットの前に立って競技で使用するバッグを指さします．

<br>

## シナリオ
### a. スタートフェーズ
1. 競技時間：競技時間は7分間になります．
2. 配置：レフェリーは，チームにロボットをスタート位置へ移動させるよう指示します．
3. スタート：レフェリーはスタートの合図を出し，タイマーをスタートさせます．同時にチームは最後の簡単なセットアップ(スタートボタンを押す等)を完了し，エリアを離れます．このとき，ボタンを2つ以上押すなど複雑なセットアップ手順の実施は認められません．また，これ以降チームがロボットに触れると即座に失格になります．
4. 指差し：オペレータはスタートの合図と同時に，2つ以上あるバッグの内，今回競技で使用するバッグの方を指さします．
5. 把持：ロボットは，オペレータが指さしたバッグを認識し，それを把持します．

### b. フォロミーフェーズ
1. 運搬開始：ロボットがバッグを把持し追従可能な状態になったら，ロボットはオペレーターにその主旨を伝えます．
2. 歩行：その後，オペレータは既知の環境から未知の環境に向かって歩き始めます．このとき，アリーナの外にあるゴール地点は固定の場所とします．
3. フォロミー：ロボットは歩き始めたオペレータを追従し，走行します．オペレータがゴールにたどり着いた場合，オペレータからその主旨を伝えてもらいます．

### c. ナビゲーションフェーズ
1. 受け渡し：オペレータとロボットがゴールに着いた後，オペレーターはロボットからバッグを受け取り，ロボットにお礼をします．
2. ナビゲーション：ロボットは未知の環境から既知の環境であるスタート地点まで自律的に移動します．このとき，ロボットは様々な障害物を回避しながら自律走行を行います．ただし，この障害物に挑戦するかどうかは各チームで決めることができます(障害物を回避するごとに加点されます)．この障害物の種類には下記の4つのモノがあります．
   - 人混み(3～4人)が邪魔をする
   - 地面にある小さな物体(積み木など)
   - 見づらい3Dオブジェクト(椅子など)
   - 開閉式バリア(ガイドポールなど)
3. ゴール：ロボットがスタート地点へ戻ったら，タスク終了になります．

<br>

## デウスエクスマキナ
本タスクでは，次のデウスエクスマキナが採用されます．デウスエクスマキナでは該当アクションの点数は入らないが，より簡単な手法でアクションをスキップし，タスクを継続することができます．

<table>
  <tr>
    <th> <b>Action<b> </th>
    <th> <b>Bypassing<b> </th>
  </tr>
  <tr>
    <td> バッグの選択 </td>
    <td>
      <ul>
        <li> 2つ以上が設置されているバッグを1つに限定する </li>
        <li> 1つのバッグのみが設置される </li>
      </ul> 
    </td>
  </tr>
   <tr>
    <td> バッグの把持 </td>
    <td>
      <ul>
        <li> ロボットが選択したバッグを，オペレータがロボットに持たせる </li>
      </ul> 
    </td>
  </tr>
  <tr>
    <td> マーカを用いた人追従走行 </td>
    <td>
      <ul>
        <li> マーカをオペレータに持たせた状態または取り付けた状態で人追従走行を行う </li>
      </ul> 
    </td>
  </tr>
   <tr>
    <td> 未知環境のマッピング </td>
    <td>
      <ul>
        <li> 事前にマッピングしてはいけない範囲のマッピングを行う
 </li>
        <li> この場合，マッピングが影響する自律移動の得点は半分になる(スコアシート中☆の箇所)
 </li>
      </ul> 
    </td>
  </tr>
</table>

<br>

## スコアシート
<table>
  <tr>
    <th> <b>Action</b> </th>
    <th> <b>Score</b> </th>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b>メインタスク</b> </td>
  </tr>
  <tr>
    <td> バッグをアリーナの外にあるゴールまで運ぶ <br> 
      <ul>
        <li> オペレータが選択したバッグの検出 </li>
        <li> 選択されたバッグの把持 </li>
        <li> オペレーターを追従してアリーナの外に出る </li>
        <li> オペレーターを追従してアリーナの外にあるゴールへ着く </li>
      </ul> 
    </td>
<!--     <td> 250 <br> 
      <ul  style="list-style: none;">
        <li> 50 </li>
        <li> 100 </li>
        <li> 50 </li>
        <li> 50 </li>
      </ul> 
    </td> -->
    <td align="center"> <!-- 250 <br> --> 50 <br> 100 <br> 50 <br> 50 </td>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b> ボーナスタスク </b> </td>
  </tr>
  <tr>
    <td> アリーナへの再入場
      <ul>
        <li> 自律的にアリーナの内に入る </li>
        <li> 自律的にスタート地点へ戻る </li>
    </td>
    <td align="center"> <!-- 50 <br> --> 25 <br> 25 </td>
  </tr>
  <tr>
    <td> 人混み(3～4人)を回避する <br> </td>
    <td align="center"> 50 </td>
  </tr>
  <tr>
    <td> 地面にある小さな物体(積み木など)を回避する <br> </td>
    <td align="center"> 50 </td>
  </tr>
  <tr>
    <td> 見づらい3Dオブジェクト(椅子など)を回避する <br> </td>
    <td align="center"> 50 </td>
  </tr>
  <tr>
    <td> 開閉式バリア(ガイドポールなど)を回避する <br> </td>
    <td align="center"> 50 </td>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b>ペナルティ</b> </td>
  </tr>
  <tr>
    <td> 不参加(無断) </td>
    <td align="center"> -500 </td>
  </tr>
  <tr>
    <td> <b>合計(ボーナスタスクを含む)</b> </td>
    <td align="center"> <b>500</b> </td>
  </tr>
</table>

※ Educationリーグと同じ競技を採用していますが，差別化のため異なる採点方式を用いています．


<br>

## 運営による指示
- 準備
  - オペレーターとして一人ボランティアを選ぶ．
  - 外の道でロボットの行く手を阻む人を3～4人選ぶ．
  - バッグの位置を選び，オペレーターにバッグを割り当てる．
  - ロボットが屋外で直面する障害物を選択する．
  - ゴール(車)の位置を選択する．
  - アリーナの外に出るときは，ロボットに注意する．
- アナウンス(競技スタート2時間前)
  - ロボットのスタート地点の選択し，アナウンスする．
  - どのバッグを使用するかの選択し，アナウンスする．
