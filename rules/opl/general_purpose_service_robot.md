# General Purpose Service Robot (GPSR)
参考動画：https://youtu.be/Hmcg-QO8Nso <br>
※ 参考動画は完璧ではありません．年によってルールも異なるので，あくまで参考程度にしてください．

※ 詳細なルールや配点につきましては，アリーナ環境が決まり次第，追加していきます．気になる点や議論したい点などがありましたら，[Issues](https://github.com/RoboCupAtHomeJP/Rule2022/issues)へお願いします．

<br>

## メインゴール
このタスクでは，ロボットがユーザからの様々な要求に対して応じる汎用サービスを想定しています．そのため，この競技では，予め決められたタスクの流れや命令，行動内容などは存在しません．競技内でユーザが要求するタスクは，大量に用意したタスク内容の中から審査員によってランダムに選択されていきます．これらの要求は，複雑さに応じて3つのカテゴリに分類され，このカテゴリの難易度に基づいて得点も変化していきます．

<br>

## フォーカス
このタスクは，複雑な音声対話，予め定義されていない命令の実行，効率的かつスピーディなタスクの実行，既知環境でのマッピングやナビゲーション，タスクプランニングなどに焦点を当てています．

<br>

## セットアップ
- ロケーション： 家庭環境を模したアリーナ環境が用いられます．特に競技はリビングルームで行われます．アリーナ内は事前にマッピングすることができます(既知の環境)．
- スタートロケーション： ロボットは，アリーナの外からスタートします．
- オペレーター：オペレーターは，ランダムに選択されたタスクを，ロボットに実行するよう命令します．オペレーターは各チームから選出してください．

<br>

## シナリオ
### a. スタートフェーズ
1. 競技時間：競技時間は10分間になります．
2. 配置：レフェリーは，チームにロボットをスタート位置へ移動させるよう指示します．
3. スタート：レフェリーはスタートの合図を出し，タイマーをスタートさせます．同時にチームは最後の簡単なセットアップ(スタートボタンを押す等)を完了し，エリアを離れます．このとき，ボタンを2つ以上押すなど複雑なセットアップ手順の実施は認められません．また，これ以降チームがロボットに触れると即座に失格になります．
4. ドアオープン：チームの1人はスタートの合図と同時にドアを開けます．このとき，ロボットはドアが開いたことを認識し，自律的にアリーナへ入場します．
5. ゴール：1つの命令タスクに対して，コマンドフェーズとサービスフェーズを行います．これを3回繰り返すことを目標としています．

### b. コマンドフェーズ
1. タスクの選択：チームがレフェリーに希望するカテゴリを伝え，ランダムにカテゴリ内のタスクを選択します．選択したカテゴリに応じてレフェリーはタスクの命令をオペレーターに伝えます．
  - Category 1：低難易度タスク
  - Category 2：中難易度タスク
  - Category 3：高難易度タスク or 不足情報/誤情報を含む命令
2. ロボットへの命令：オペレータは，ここで選択されたタスクをロボットに命令します．このとき，ロボットがオペレータの命令について理解できなかった場合，もう一度発言を繰り返すように要求することができます．もし，受け取った命令で不足する情報があればロボットから人間に聞くこともできます．

### c. サービスフェーズ
1. 命令の復唱：ロボットは命令受け取ったあと，命令内容を復唱してから行動を開始します．
2. サービス：ロボットは，与えられた命令のタスクを実行します．タスクの終了後は，次の命令のためにオペレータのもとへ戻ってきます．このときは，再度ドアオープンしてアリーナに入る必要はありません．

  **※ 何もせずに次の質問へ移行することの禁止**<br>
     2回目，3回目の命令を達成するとスコアが高くなるため，あえて命令を聞き取るだけにとどめて，何もせずに戻ってきて次の命令にトライすることは禁止とします．
     タスク達成のために何らかの挑戦を行わなければないけません．また，2回目，3回目の命令のスコアの扱いは1回目，2回目のタスクを達成できたかどうかで判断します．
  
  **※ コマンドジェネレータの事前公開**<br>
     RoboCup@Homeの[GitHubに公開されているコマンドジェネレータ](https://github.com/RoboCupAtHome/Sydney2019)を使用します(2019 Sydney 世界大会)．
     しかし，カテゴリやオブジェクト，場所名などは本番用に向けて変更されるので，あくまでテスト用としての使用に限ります．

<br>

## デウスエクスマキナ
本タスクでは，次のデウスエクスマキナが採用されます．デウスエクスマキナでは該当アクションの点数は入らないが，より簡単な手法でアクションをスキップし，タスクを継続することができます．

<table>
  <tr>
    <th> <b>Action<b> </th>
    <th> <b>Bypassing<b> </th>
  </tr>
  <tr>
    <td> 音声対話 </td>
    <td>
      <ul>
        <li> マーカを用いてオペレータとのコミュニケーションを図る </li>
      </ul> 
    </td>
  </tr>
   <tr>
    <td> タスクの支援 </td>
    <td>
      <ul>
        <li> ロボットがタスクを行うのを何かしらの方法で支援する事もできる </li>
        <li> その場合，審査員基準で50～200pts減点される </li>
      </ul> 
    </td>
  </tr>
   <tr>
    <td> コマンドセットの使用 </td>
    <td>
      <ul>
        <li> Command Category 1の命令文をコマンドジェネレータで生成する代わりに，コマンドセットを使用する </li>
        <li> その場合，命令理解の得点は0.7倍される </li>
      </ul> 
    </td>
  </tr>
</table>
     
### コマンドセット
<table>
  <tr>
    <th> <b>タスクの種類<b> </th>
    <th> <b>命令文例<b> </th>
  </tr>
  <tr>
    <td> bring </td>
    <td>
      <ul>
        <li> Go to the &dollar; 部屋名, grasp the &dollar; 物体名 on the &dollar; 場所名 and place it on the &dollar; 場所名. </li>
        <li> Go to the &dollar; 部屋名, grasp the &dollar; 物体名 on the &dollar; 場所名 and give it to &dollar; 人物名. </li>
      </ul> 
    </td>
  </tr>
  <tr>
    <td> vision <br> (find obj | people) </td>
    <td>
      <ul>
        <li> Tell me how many &dollar; 物体カテゴリー名 there are on the  &dollar; 場所名. </li>
        <li> Tell me how many people in the &dollar; 部屋名 are &dollar; ポーズ. </li>
      </ul> 
    </td>
  </tr>
  <tr>
    <td> navigation <br> (follow, guide) </td>
    <td>
      <ul>
        <li> Go to the &dollar; 部屋名, find &dollar; 人物名 at the &dollar; 場所名 and follow (him | her). </li>
        <li> Go to the &dollar; 部屋名, find &dollar; 人物名 at the &dollar; 場所名 and guide (him | her) to the &dollar; 場所名. </li>
      </ul> 
    </td>
  </tr>
  <tr>
    <td> speech <br> (question, answer) </td>
    <td>
      <ul>
        <li> Go to the &dollar; 部屋名, find &dollar; 人物名 at the &dollar; 場所名 and answer (his | her) question. </li>
        <li> Go to the &dollar; 部屋名, find &dollar; 人物名 at the &dollar; 場所名 and ask (him | her) &dollar; 質問. </li>
      </ul> 
    </td>
  </tr>
</table>

<br>

## スコアシート
<table>
  <tr>
    <th> <b>Action</b> </th>
    <th> <b>Score</b> </th>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b>メインタスク</b> </td>
  </tr>
  <tr>
    <td> 命令を理解できた </td>
    <td align="center"> 3 × 20 </td>
  </tr>
  <tr>
    <td> 1回目の命令タスク※を実行 <br> 
      <ul>
        <li> タスクを完遂する(Command Category(Cat. = 1, 2, 3)で倍率変動) </li>
        <ul>
          <li> 把持対象の場所まで移動する </li>
          <li> 物体を把持する </li>
          <li> 設置対象の場所まで移動する </li>
          <li> 物体を正しい場所に設置・収納する </li>
        </ul>
      </ul> 
    </td>
    <td align="center"> <!-- 60 <br> --> 20 × Cat. <br> 5 <br> 5 <br> 5 <br> 5 </td>
  </tr>
  <tr>
    <td> 2回目の命令タスク※を実行</b> <br> 
      <ul>
        <li> タスクを完遂する(Command Category(Cat. = 1, 2, 3)で倍率変動) </li>
        <ul>
          <li> 把持対象の場所まで移動する </li>
          <li> 物体を把持する </li>
          <li> 設置対象の場所まで移動する </li>
          <li> 物体を正しい場所に設置・収納する </li>
        </ul>
      </ul> 
    </td>
    <td align="center"> <!-- 60 <br> --> 40 × Cat. <br> 10 <br> 10 <br> 10 <br> 10 </td>
  </tr>
  <tr>
    <td> 3回目の命令タスク※を実行 <br> 
      <ul>
        <li> タスクを完遂する(Command Category(Cat. = 1, 2, 3)で倍率変動) </li>
        <ul>
          <li> 把持対象の場所まで移動する </li>
          <li> 物体を把持する </li>
          <li> 設置対象の場所まで移動する </li>
          <li> 物体を正しい場所に設置・収納する </li>
        </ul>
      </ul> 
    </td>
    <td align="center"> <!-- 60 <br> --> 80 × Cat. <br> 20 <br> 20 <br> 20 <br> 20 </td>
  </tr>
  <tr>
    <td> 全てのコマンドを実行した後アリーナから退出 </td>
    <td align="center"> 20 </td>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b>ペナルティ</b> </td>
  </tr>
  <tr>
    <td> 不参加(無断) </td>
    <td align="center"> -500 </td>
  </tr>
  <tr>
    <td> <b>合計(ボーナスタスクを除く)</b> </td>
    <td align="center"> <b>500</b> </td>
  </tr>
</table>

※ スコアシートでは，Bringタスクを例に部分点を記載しています．

<br>

## 運営(EC)による指示
- 準備(Setup day)
  - 部屋，ロケーション，人物の名称を公開します．
  - 物体の置かれる可能性がある場所を公開します．
  - オペレータ(人物)から命令を聞く可能性のある場所を公開します．
- アナウンス(競技2時間前)
  - アリーナの入口と出口のドアの場所を公開します．

<br>

## レフェリー(TC)の動き
※TCは各チームから数名選出され，他チームの競技において以下を行ってもらいます．
- 競技開始30分前に集まり，説明を受け，スコアシートとコマンドリストを受け取ります．
- シナリオに記載のレフェリーとして行動します．
- 競技を採点します．
- 他のTCと採点内容を確認します．
- スコアシートを提出します．
