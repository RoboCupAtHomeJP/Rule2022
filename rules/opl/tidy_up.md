# TidyUp for OPL

参考動画：https://youtu.be/sVmFMCnJf8s <br>
※ 参考動画は完璧ではありません．年によってルールも異なるので，あくまで参考程度にしてください．

※ 詳細なルールや配点につきましては，アリーナ環境が決まり次第，追加していきます．気になる点や議論したい点などがありましたら，[Issues](https://github.com/RoboCupAtHomeJP/Rule2022/issues)へお願いします．

<br>

## メインゴール
このタスクでは，ロボットが散らかった部屋のお片付けをすることを想定しています．事前に物体をどこに片付けるのかが指定されているため，ロボットはその情報をもとに所定の場所に片付けていきます．その後，要求があれば手を振っている人に，棚から指定された物を提供していきます．WRS(World Robot Summit)で行われた競技をOPL用にアレンジした競技になっています．

<br>

## フォーカス
このタスクは，既知環境でのマッピングやナビゲーション，物体認識，物体把持，タスクプランニングなどに焦点を当てています．

<br>

## セットアップ
- ロケーション： 家庭環境を模したアリーナ環境が用いられます．特に競技はリビングルームで行われます．アリーナ内は事前にマッピングすることができます(既知の環境)．
- スタートロケーション： ロボットは，アリーナの外からスタートします．
- ゲスト： 2人のゲストは椅子に座っており，そのうち手を挙げている1人がロボットから物体を受け取ります．2人のゲストは各チームから選出してください
<br>

## シナリオ
### a. スタートフェーズ
1. 競技時間：競技時間は 片付けフェーズ(Task 1)が15分，デリバリーフェーズ(Task 2)が5分の計20分間になります．
2. 配置：レフェリーは，チームにロボットをスタート位置へ移動させるよう指示します．また，このときレフェリーの指示通りに，使用する物体を配置していきます．配置する物体数は最大で10個です．
3. スタート：レフェリーはスタートの合図を出し，タイマーをスタートさせます．同時にチームは最後の簡単なセットアップ(スタートボタンを押す等)を完了し，エリアを離れます．このとき，ボタンを2つ以上押すなど複雑なセットアップ手順の実施は認められません．また，これ以降チームがロボットに触れると即座に失格になります．
4. ドアオープン：チームの1人はスタートの合図と同時にドアを開けます．このとき，ロボットはドアが開いたことを認識し，自律的にアリーナへ入場します．

### b. 片付けフェーズ (Task 1)
1. 競技時間：片付けフェーズ(Task 1)の競技時間は15分間です．
2. 片付け：ドアオープン後，ロボットはテーブルの上に並べられた物体を全て片付けていきます．家庭環境には，既知と未知の物体が混同して設置されています．それぞれの物体にはカテゴリがあり，それぞれで片付ける場所が決まっています．これらは事前に指定されているので，ロボットはそれをもとに物体を片付けていきます．

### c. デリバリーフェーズ (Task 2)
1. 競技時間：デリバリーフェーズ(Task 2)の競技時間は5分間です．
2. ナビゲーション：ロボットは一方の部屋からもう一方の部屋へ移動します．このとき，ロボットの移動を妨げるような障害物を設置するので，ロボットはこれらと接触しないように移動を行っていきます．
3. デリバリー：ロボットは，棚に並ぶ物体から事前に指示された物体を見つけて把持します．把持した物体は，イスに座っている人のうち，手を振っている人に渡します．
4. ゴール：ロボットが人に物体を渡した時点で，タスク終了になります．

<br>

## デウスエクスマキナ
本タスクでは，次のデウスエクスマキナが採用されます．デウスエクスマキナでは該当アクションの点数は入らないが，より簡単な手法でアクションをスキップし，タスクを継続することができます．

<table>
  <tr>
    <th> <b>Action<b> </th>
    <th> <b>Bypassing<b> </th>
  </tr>
  <tr>
    <td> 物体数の調整 </td>
    <td>
      <ul>
        <li> 配置する物体の数を任意の数に減らす </li>
        <li> どの物体を減らすかはチームで選択することが出来る </li>
      </ul> 
    </td>
  </tr>
  <tr>
    <td> 物体の把持 </td>
    <td>
      <ul>
        <li> ロボットが指示した物体を，レフェリーがロボットに持たせる(あるいは特定の場所に置く) </li>
        <li> このとき，ロボットは物体の位置と名前，指示などを正確に伝える必要がある </li>
      </ul> 
    </td>
  </tr>
   <tr>
    <td> 物体の設置 </td>
    <td>
      <ul>
        <li> レフェリーがロボットの持っている(あるいは特定の場所にある)物体を，ロボットの指示した場所に設置する </li>
        <li> このとき，ロボットは物体の位置と名前，指示などを正確に伝える必要がある </li>
      </ul> 
    </td>
  </tr>
  <tr>
    <td> 物体の受け渡し </td>
    <td>
      <ul>
        <li> ゲストがロボットの持っている(あるいは特定の場所にある)物体を，ロボットから渡されることなく受け取る </li>
        <li> このとき，ロボットは物体の位置と名前，指示などを正確に伝える必要がある </li>
      </ul> 
    </td>
  </tr>
</table>

<br>

## スコアシート
<table>
  <tr>
    <th> <b>Action</b> </th>
    <th> <b>Score</b> </th>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b>メインタスク (Task 1)</b> </td>
  </tr>
  <tr>
    <td> 物体を片付ける <br> 
      <ul>
        <li> 物体を把持する (10点/1個) </li>
        <li> 物体を運搬し，設置・収納する (10点/1個) </li>
        <li> 物体を正しい場所に設置・収納する (15点/1個) </li>
      </ul> 
    </td>
    <td align="center"> <!-- 200 <br> --> 10 × 10 <br> 10 × 10 <br> 10 × 15 </td>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b>メインタスク (Task 2)</b> </td>
  </tr>
  <tr>
    <td> 障害物に衝突することなくダイニングルームに入る </td>
    <td align="center"> 30 </td>
  </tr>
  <tr>
    <td> 物体を提供する <br> 
      <ul>
        <li> 棚からフードアイテムを把持する </li>
        <li> 棚から指示されたフードアイテムを把持する </li>
        <li> 人に物体を渡す </li>
        <li> 手を挙げている人を検出し，物体を渡す </li>
      </ul> 
    </td>
    <td align="center"> <!-- 200 <br> --> 30 <br> 30 <br> 30 <br> 30 </td>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b>ペナルティ</b> </td>
  </tr>
  <tr>
    <td> 不参加(無断) </td>
    <td align="center"> -500 </td>
  </tr>
  <tr>
    <td> <b>合計(ボーナスタスクを含む)</b> </td>
    <td align="center"> <b>500</b> </td>
  </tr>
</table>

OPLのスコアシート：[RCJP_opl_tidyup_scoresheet_v1](https://docs.google.com/spreadsheets/d/1Dn0LTINAVYMcSL2Yoqi4iicPZOmU6h8e/edit?usp=sharing&ouid=115914283332872721627&rtpof=true&sd=true)

<br>

## 運営(EC)による指示
- 準備(競技の数日～数週間前)
  - 未知物体を選択し，購入します．
- アナウンス(競技の30分前から)
  - 物体の初期設置場所を選択し，アナウンスします．
  - 未知物体を指定し，アナウンスします．

<br>

## レフェリー(TC)の動き
※TCは各チームから数名選出され，他チームの競技において以下を行ってもらいます．
- 競技開始30分前に集まり，説明を受け，スコアシートを受け取ります．
- シナリオに記載のレフェリーとして行動します．
- 競技を採点します．
- 他のTCと採点内容を確認します．
- スコアシートを提出します．
